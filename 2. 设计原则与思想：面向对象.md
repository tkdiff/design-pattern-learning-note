## 设计原则与思想：面向对象

> 本文是 《设计模式之美》 - 设计原则与思想：面向对象（11讲）的学习笔记。

----

### 04 | 理论一：当谈论面向对象的时候，我们到底在谈论什么？

#### 1. 什么是面向对象编程

面向对象编程是一种编程范式或编程风格。它以类或对象作为组织代码的基本单元，并将封装、抽象、继承、多态四个特性，作为代码设计和实现的基石 。

#### 2. 什么是面向对象编程语言？

面向对象编程语言是支持类或对象的语法机制，并用现成的语法机制，能方便地实现面向对象编程四大特性（封装、抽象、继承、多态）的编程语言。

#### 3. 如何判定一个编程语言是否是面向对象编程语言？

如果按照严格的的定义，需要有现成的语法支持类、对象、四大特性才能叫作面向对象编程语言。如果放宽要求的话，只要某种编程语言支持类、对象语法机制，那基本上就可以说这种编程语言是面向对象编程语言了，不一定非得要求具有所有的四大特性。

#### 4. 面向对象编程和面向对象编程语言之间有何关系？

面向对象编程一般使用面向对象编程语言来进行，但是，不用面向对象编程语言，我们照样可以进行面向对象编程。反过来讲，即便我们使用面向对象编程语言，写出来的代码也不一定是面向对象编程风格的，也有可能是面向过程编程风格的。

#### 5. 什么是面向对象分析和面向对象设计？

简单点讲，面向对象分析就是要搞清楚做什么，面向对象设计就是要搞清楚怎么做。两个阶段最终的产出是类的设计，包括程序被拆解为哪些类，每个类有哪些属性方法、类与类之间如何交互等等。

----

### 05 | 理论二：封装、抽象、继承、多态分别可以解决哪些编程问题？

![面向对象的四大特性](https://seven-blog-2019.oss-cn-beijing.aliyuncs.com/面向对象的四大特性.png)

#### 1. 封装

**WHAT**：封装也叫作信息隐藏或者数据访问保护。类通过暴露有限的访问接口，授权外部仅能通过类提供的方式来访问内部信息或者数据。

**HOW**： 访问权限控制（private、protected、public）

**WHY**：保护数据不被随意修改提高代码的可维护性； 仅暴露有限的不要接口、提高类的可用性

#### 2. 抽象

**WHAT**：隐藏方法的具体实现。让调用者只需要关心方法提供了哪些功能，并不需要知道这些功能是如何实现的

**HOW**：接口类（interface）和 抽象类 （abstract）

**WHY**：
- 提高代码的可扩展性、维护性，修改实现不需要改变定义，减少代码的改动范围
- 是处理复杂系统的有效手段，能有效地过滤掉不必要关注的信息

#### 3. 继承

**WHAT**：用来标识类之间的 is-a 关系，比如猫是一种哺乳动物。
分类：
- 单继承：一个子类只继承一个父类
- 多继承：一个子类可以继承多个子类。Java 不支持多继承。

**HOW**： extents

**WHY**：

- 代码复用
- 通过继承来关联两个类，反应真实世界中的这种关系，非常符合人类的认知
- 结构美感
过度使用继承带来的坏处： 可读性差，可维护性差。

#### 4. 多态

**WHAT**：子类可以替换父类，在实际的代码运行过程中，调用子类的方法实现

**HOW**：

- 继承
- 接口类
- duck-typing

**WHY**：
- 能提高代码的可扩展性和复用性
- 是很多设计模式、设计原则、编程技巧的代码实现基础

-----

### 06 | 理论三：面向对象相比面向过程有哪些优势？面向过程真的过时了吗？

![面向对象编程与面向过程编程的区别和联系](https://seven-blog-2019.oss-cn-beijing.aliyuncs.com/面向对象编程与面向过程编程的区别和联系.png)

面向对象编程比起面向过程编程的优势主要有三个：

- 对于大规模复杂程序的开发，程序的处理流程并非单一的一条主线，而是错综复杂的网状结构。面向对象编程比起面向过程编程，更能应对这种复杂类型的程序开发。
- 面向对象编程相比面向过程编程，具有更加丰富的特性（封装、抽象、继承、多态）。利用这些特性编写出来的代码，更加易扩展、易复用、易维护。
- 从编程语言跟机器打交道的方式的演进规律中，我们可以总结出：面向对象编程语言比起面向过程编程语言，更加人性化、更加高级、更加智能。

----
### 07 | 理论四：哪些代码设计看似是面向对象，实际是面向过程的？

#### 1. 滥用 getter、setter 方法

在设计类的时候，除非真的需要，否则，尽量不要给属性定义 setter 方法。

#### 2. 滥用全局变量和全局方法

Constants 类、Utils 类的设计问题

职责单一：一些细化的小类

#### 3. 定义数据和方法分离的类

基于贫血模型的传统开发模式

----

### 08 | 理论五：接口vs抽象类的区别？如何用普通的类模拟抽象类和接口？

#### 1. 抽象类和接口的语法特性

抽象类不允许被实例化，只能被继承。它可以包含属性和方法。方法既可以包含代码实现，也可以不包含代码实现。不包含代码实现的方法叫作抽象方法。子类继承抽象类，必须实现抽象类中的所有抽象方法。接口不能包含属性，只能声明方法，方法不能包含代码实现。类实现接口的时候，必须实现接口中声明的所有方法。

#### 2. 抽象类和接口存在的意义

抽象类是对成员变量和方法的抽象，是一种 is-a 关系，是为了解决代码复用问题。接口仅仅是对方法的抽象，是一种 has-a 关系，表示具有某一组行为特性，是为了解决解耦问题，隔离接口和具体的实现，提高代码的扩展性。

#### 3. 抽象类和接口的应用场景区别

什么时候该用抽象类？什么时候该用接口？实际上，判断的标准很简单。如果要表示一种 is-a 的关系，并且是为了解决代码复用问题，我们就用抽象类；如果要表示一种 has-a 关系，并且是为了解决抽象而非代码复用问题，那我们就用接口。

----

### 09 | 理论六：为什么基于接口而非实现编程？有必要为每个类都定义接口吗？

#### 1. 基于抽象而非实现编程

"基于接口而非实现编程"，这条原则的另一个表述方式，是"基于抽象而非实现编程"。我们在做软件开发的时候，一定要有抽象意识、接口意识。越抽象、越顶层、越脱离具体某一实现的设计，越能提高代码的灵活性、扩展性、可维护性。

#### 2. 通用的命名

我们在定义接口的时候，一方面，命名要足够通用，不能包含跟具体实现相关的字眼；另一方面，与特定实现有关的方法不要定义在接口中。

#### 3. 指导设计

"基于接口而非实现编程"这条原则，不仅仅可以指导非常细节的编程开发，还能指导更加上层的架构设计、系统设计等。

---
### 10 | 理论七：为何说要多用组合少用继承？如何决定该用组合还是继承？

#### 1. 为什么不推荐使用继承 ？

继承是面向对象的四大特性之一，用来标识类之间的 is-a 关系，可以解决代码复用的问题。虽然继承有诸多作用，但继承层次过深、过复杂，也会影响到代码的可维护性。在这种情况下，我们应该尽量少用，甚至不用继承。

#### 2. 组合相比继承有哪些优势 ？

继承主要有三个作用：表示 is-a 关系，支持多态特性，代码复用。而这三个作用都可以通过组合、接口、委托三个技术手段来达成。除此之外，利用组合还能解决层次过深、过复杂的继承关系影响代码可维护性的问题。

#### 3. 如何判断该用组合还是继承 ？

如果类之间的继承结构稳定，层次比较浅，关系不复杂，我们就可以使用继承；
反之，尽量使用组合来替代继承。

---

### 11 | 实战一（上）：业务开发常用的基于贫血模型的MVC架构违背OOP吗？

#### 什么是基于贫血模型的传统开发模式？

只包含数据，不包含业务逻辑的类，叫做**贫血模型**（Anemic Domain Model）。

贫血模型将数据与操作分离，破坏了面向对象的封装特性，是一种典型的面向过程的编程风格。

#### 什么是基于充血模型的 DDD 开发模型

**DDD**：Domain Driven Design 领域驱动设计， 主要是用来指导如何解耦业务系统，划分业务模块，定义业务领域模型及其交互。

基于充血模型的 DDD 开发模式实现的代码，也是按照 MVC 三层架构分层的。Controller 层还是负责暴露接口，Repository 层还是负责数据存取，Service 层负责核心业务逻辑。它跟基于贫血模型的传统开发模式的区别主要在 Service 层。

在基于充血模型的 DDD 开发模式中，Service 层包含 Service 类和 Domain 类两部分。Domain 就相当于贫血模型中的 BO。不过，Domain 与 BO 的区别在于它是基于充血模型开发的，既包含数据，也包含业务逻辑。而 Service 类变得非常单薄。

**总结**：

- 基于贫血模型的传统开发模式，重 Service 轻 BO；
- 基于充血模型的 DDD 开发模式，轻 Service 重 BO。

---

### 12 | 实战一（下）：如何利用基于充血模型的DDD开发一个虚拟钱包系统？

#### 1. 区别在 Service 层

基于充血模型的 DDD 开发模式跟基于贫血模型的传统开发模式相比，主要区别在 Service 层。在基于充血模型的开发模式下，我们把部分原本在 Service 类中的业务逻辑移动到了一个充血的 Domain 领域模型中，让 Service 类的实现依赖这个 Domain 类。

#### 2. Service 层并不会完全移除

在基于充血模型的 DDD 开发模式下，Service 层并不会完全移除，而是负责一些不适合放在 Domain 类中的功能。比如，负责和 Repository 层打交道、跨领域模型的业务聚合功能、幂等事务等非功能性的工作。

#### 3. Controller 层和 Repository 层的代码基本上相同

基于充血模型的 DDD 开发模式跟基于贫血模型的传统开发模式相比，Controller 层和 Repository 层的代码基本上相同。这是因为，Repository 层的 Entity 生命周期有限，Controller 层的 VO 只是单纯的作为一种 DTO。两部分的业务逻辑都不会太复杂。业务逻辑主要集中在 Service 层。所以，Repository 层和 Controller 层继续沿用贫血模型的设计思路是没有问题的。

---

### 13 | 实战二（上）：如何对接口鉴权这样一个功能开发做面向对象分析？

![需求分析](https://seven-blog-2019.oss-cn-beijing.aliyuncs.com/需求分析.png)

----

### 14 | 实战二（下）：如何利用面向对象设计和编程开发接口鉴权功能？

#### 1. 划分职责进而识别出有哪些类

根据需求描述，我们把其中涉及的功能点，一个一个罗列出来，然后再去看哪些功能点职责相近，操作同样的属性，可否归为同一个类。

#### 2. 定义类及其属性和方法

识别出需求描述中的动词，作为候选的方法，再进一步过滤筛选出真正的方法，把功能点中涉及的名词，作为候选属性，然后同样再进行过滤筛选。

#### 3. 定义类与类之间的交互关系

UML 统一建模语言中定义了六种类之间的关系。它们分别是：泛化、实现、关联、聚合、组合、依赖。我们从更加贴近编程的角度，对类与类之间的关系做了调整，保留四个关系：泛化、实现、组合、依赖。

#### 4. 将类组装起来并提供执行入口

我们要将所有的类组装在一起，提供一个执行入口。这个入口可能是一个 main() 函数，也可能是一组给外部用的 API 接口。通过这个入口，我们能触发整个代码跑起来。

![面向对象分析、面向对象设计、面向对象编程](https://seven-blog-2019.oss-cn-beijing.aliyuncs.com/面向对象分析、面向对象设计、面向对象编程.png)

----


### 总结

![编程方法论](https://seven-blog-2019.oss-cn-beijing.aliyuncs.com/编程方法论.png)
